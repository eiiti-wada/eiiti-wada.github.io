<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>rubikcube 2018/12/12</title>
  <style>
canvas {
  border: solid 1px #999;
}
  </style>
</head>
 
<body>
  <a onclick="initialize()">
  <canvas id="mycanvas" width="500" height="300"></canvas> 
  <script>
var canvas = document.getElementById("mycanvas");
var context = canvas.getContext("2d");
var dt,hr=0,mn=0,sec=0;
//function str(x) {return x<10?" "+x:x;}
function str(x) {return ('  '+x).slice(-2);}				 
function divmod(n,d){
return [Math.floor(n/d),n-d*Math.floor(n/d)];}
var restmode=false;

function disparray (as){
for(var i=0;i<as.length;i=i+40){alert(i+":"+as.slice(i,i+40));}}

function compress(ls){
  var s="";
  for(var i=0;i<ls.length;i++){
    s=s.concat(ls[i].toString());}
  return s;}

var ccs=[];			      
for(i=0;i<54;i++){ccs.push(Math.floor(i/9));}

var rotseq=[];
function listcopy(a){
var b =[];
for(var i=0;i<a.length;i++){b.push(a[i]);}
return b;}
var rotseq2=listcopy(rotseq);

function eqarray (as,bs){
var truth=true;
if(as.length!=bs.length){truth=false;}
else{for(var i=0;i<as.length;i++){
if(as[i]!=bs[i]){truth=false;}}}
return truth;}
var intervalID;
var time=0;

var foo =[  //修正済み
[[0,2,8,6],[1,5,7,3],[15,24,33,42],[12,21,30,39],[9,18,27,36]], //t+
[[9,11,17,15],[10,14,16,12],[6,44,45,18],[3,43,46,19],[0,42,47,20]], //n+
[[18,20,26,24],[19,23,25,21],[0,17,51,27],[1,16,48,28],[2,15,45,29]], //e+
[[27,29,35,33],[28,32,34,30],[2,26,53,36],[5,25,52,37],[8,24,51,38]], //s+
[[36,38,44,42],[37,41,43,39],[8,35,47,9],[7,34,50,10],[6,33,53,11]], //w+
[[45,47,53,51],[46,50,52,48],[11,38,29,20],[14,41,32,23],[17,44,35,26]], //b+
[[51,53,47,45],[48,52,50,46],[20,29,38,11],[23,32,41,14],[26,35,44,17]], //b-
[[42,44,38,36],[39,43,41,37],[9,47,35,8],[10,50,34,7],[11,53,33,6]], //w-
[[33,35,29,27],[30,34,32,28],[36,53,26,2],[37,52,25,5],[38,51,24,8]], //s-
[[24,26,20,18],[21,25,23,19],[27,51,17,0],[28,48,16,1],[29,45,15,2]], //e-
[[15,17,11,9],[12,16,14,10],[18,45,44,6],[19,46,43,3],[20,47,42,0]], //n-
[[6,8,2,0],[3,7,5,1],[42,33,24,15],[39,30,21,12],[36,27,18,9]]]; //t-

function rotatecube(n){   //rotation function
if(restmode){rotseq.push(n);}
  var g=foo[n];
  for(var i=0;i<5;i++){f=g[i];a=f[0],b=f[1],c=f[2],d=f[3];
  var t=ccs[d];
  ccs[d]=ccs[c];ccs[c]=ccs[b];ccs[b]=ccs[a];ccs[a]=t;}}
function chief(xy){
context.fillStyle="#000000";
context.fillRect((xy[0]+xy[4])/2-2.5,(xy[1]+xy[5])/2-2.5,5,5);}
function drawparagram(c,xy){   //draw paralleogram 
context.fillStyle = c;
context.beginPath();     //fill body
  context.moveTo(xy[0],xy[1]);
  context.lineTo(xy[2],xy[3]);
  context.lineTo(xy[4],xy[5]);
  context.lineTo(xy[6],xy[7]);
  context.closePath();
  context.fill();
context.fillStyle = "#000000";  //draw outer line
context.beginPath();
   context.moveTo(xy[0],xy[1]);
   context.lineTo(xy[2],xy[3]);
   context.lineTo(xy[4],xy[5]);
   context.lineTo(xy[6],xy[7]);
   context.closePath();
   context.stroke();}

function drawparagram2(n,xy){   //draw paralleogram 
context.fillStyle = "#000000";  //draw outer line
context.beginPath();
   context.moveTo(xy[0],xy[1]);
   context.lineTo(xy[2],xy[3]);
   context.lineTo(xy[4],xy[5]);
   context.lineTo(xy[6],xy[7]);
   context.closePath();
   context.stroke();
   center2((xy[0]+xy[4])/2,(xy[1]+xy[5])/2,n);
}
var pos=[            // position of all faces
[103.923,-0.,138.564,-20.,103.923,-40.,69.282,-20.],//0
[69.282,-20.,103.923,-40.,69.282,-60.,34.641,-40.],//1
[34.641,-40.,69.282,-60.,34.641,-80.,0.,-60.],//2
[138.564,-20.,173.205,-40.,138.564,-60.,103.923,-40.],//3
[103.923,-40.,138.564,-60.,103.923,-80.,69.282,-60.],//4
[69.282,-60.,103.923,-80.,69.282,-100.,34.641,-80.],//5
[173.205,-40.,207.846,-60.,173.205,-80.,138.564,-60.],//6
[138.564,-60.,173.205,-80.,138.564,-100.,103.923,-80.],//7
[103.923,-80.,138.564,-100.,103.923,-120.,69.282,-100.],//8
[173.205,-0.,207.846,-20.,207.846,-60.,173.205,-40.],//9
[173.205,40.,207.846,20.,207.846,-20.,173.205,-0.],//10
[173.205,80.,207.846,60.,207.846,20.,173.205,40.],//11
[138.564,20.,173.205,-0.,173.205,-40.,138.564,-20.],//12
[138.564,60.,173.205,40.,173.205,-0.,138.564,20.],//13
[138.564,100.,173.205,80.,173.205,40.,138.564,60.],//14
[103.923,40.,138.564,20.,138.564,-20.,103.923,-0.],//15
[103.923,80.,138.564,60.,138.564,20.,103.923,40.],//16
[103.923,120.,138.564,100.,138.564,60.,103.923,80.],//17
[103.923,40.,103.923,-0.,69.282,-20.,69.282,20.],//18
[103.923,80.,103.923,40.,69.282,20.,69.282,60.],//19
[103.923,120.,103.923,80.,69.282,60.,69.282,100.],//20
[69.282,20.,69.282,-20.,34.641,-40.,34.641,-0.],//21
[69.282,60.,69.282,20.,34.641,-0.,34.641,40.],//22
[69.282,100.,69.282,60.,34.641,40.,34.641,80.],//23
[34.641,-0.,34.641,-40.,0.,-60.,0.,-20.],//24
[34.641,40.,34.641,-0.,0.,-20.,0.,20.],//25
[34.641,80.,34.641,40.,0.,20.,0.,60.],//26
[0.,-20.,0.,-60.,-34.641,-80.,-34.641,-40.],//27
[0.,20.,0.,-20.,-34.641,-40.,-34.641,-0.],//28
[0.,60.,0.,20.,-34.641,-0.,-34.641,40.],//29
[-34.641,-40.,-34.641,-80.,-69.282,-100.,-69.282,-60.],//30
[-34.641,-0.,-34.641,-40.,-69.282,-60.,-69.282,-20.],//31
[-34.641,40.,-34.641,-0.,-69.282,-20.,-69.282,20.],//32
[-69.282,-60.,-69.282,-100.,-103.923,-120.,-103.923,-80.],//33
[-69.282,-20.,-69.282,-60.,-103.923,-80.,-103.923,-40.],//34
[-69.282,20.,-69.282,-20.,-103.923,-40.,-103.923,-0.],//35
[-138.564,-60.,-103.923,-80.,-103.923,-120.,-138.564,-100.],//36
[-138.564,-20.,-103.923,-40.,-103.923,-80.,-138.564,-60.],//37
[-138.564,20.,-103.923,-0.,-103.923,-40.,-138.564,-20.],//38
[-173.205,-40.,-138.564,-60.,-138.564,-100.,-173.205,-80.],//39
[-173.205,-0.,-138.564,-20.,-138.564,-60.,-173.205,-40.],//40
[-173.205,40.,-138.564,20.,-138.564,-20.,-173.205,-0.],//41
[-207.846,-20.,-173.205,-40.,-173.205,-80.,-207.846,-60.],//42
[-207.846,20.,-173.205,-0.,-173.205,-40.,-207.846,-20.],//43
[-207.846,60.,-173.205,40.,-173.205,-0.,-207.846,20.],//44
[-103.923,120.,-69.282,100.,-103.923,80.,-138.564,100.],//45
[-138.564,100.,-103.923,80.,-138.564,60.,-173.205,80.],//46
[-173.205,80.,-138.564,60.,-173.205,40.,-207.846,60.],//47
[-69.282,100.,-34.641,80.,-69.282,60.,-103.923,80.],//48
[-103.923,80.,-69.282,60.,-103.923,40.,-138.564,60.],//49
[-138.564,60.,-103.923,40.,-138.564,20.,-173.205,40.],//50
[-34.641,80.,0.,60.,-34.641,40.,-69.282,60.],//51
[-69.282,60.,-34.641,40.,-69.282,20.,-103.923,40.],//52
[-103.923,40.,-69.282,20.,-103.923,-0.,-138.564,20.]]; //53
var post=  //position of t turn 
[[30.438,22.426,79.428,22.426,79.428,-17.574,30.438,-17.574],
[79.428,22.426,128.418,22.426,128.418,-17.574,79.428,-17.574],
[128.418,22.426,177.408,22.426,177.408,-17.574,128.418,-17.574],
[30.438,-17.574,79.428,-17.574,79.428,-44.24,30.438,-44.24],
[79.428,-17.574,128.418,-17.574,128.418,-44.24,79.428,-44.24],
[128.418,-17.574,177.408,-17.574,177.408,-44.24,128.418,-44.24],
[30.438,-44.24,79.428,-44.24,79.428,-70.907,30.438,-70.907],
[79.428,-44.24,128.418,-44.24,128.418,-70.907,79.428,-70.907],
[128.418,-44.24,177.408,-44.24,177.408,-70.907,128.418,-70.907],
[30.438,-70.907,79.428,-70.907,79.428,-97.574,30.438,-97.574],
[79.428,-70.907,128.418,-70.907,128.418,-97.574,79.428,-97.574],
[128.418,-70.907,177.408,-70.907,177.408,-97.574,128.418,-97.574],
[-30.438,-97.574,-79.428,-97.574,-79.428,-57.574,-30.438,-57.574],
[-79.428,-97.574,-128.418,-97.574,-128.418,-57.574,-79.428,-57.574],
[-128.418,-97.574,-177.408,-97.574,-177.408,-57.574,-128.418,-57.574]];
var pose=
[[160.087,52.426,135.592,10.,100.951,30.,125.446,72.426],
[135.592,10.,111.097,-32.426,76.456,-12.426,100.951,30.],
[111.097,-32.426,86.603,-74.853,51.962,-54.853,76.456,-12.426],
[125.446,72.426,100.951,30.,77.857,43.333,102.352,85.76],
[100.951,30.,76.456,-12.426,53.362,.907,77.857,43.333],
[76.456,-12.426,51.962,-54.853,28.868,-41.519,53.362,.907],
[102.352,85.76,77.857,43.333,54.763,56.667,79.258,99.093],
[77.857,43.333,53.362,.907,30.268,14.24,54.763,56.667],
[53.362,.907,28.868,-41.519,5.774,-28.186,30.268,14.24],
[79.258,99.093,54.763,56.667,31.669,70.,56.164,112.426],
[54.763,56.667,30.268,14.24,7.174,27.574,31.669,70.],
[30.268,14.24,5.774,-28.186,-17.321,-14.853,7.174,27.574],
[-56.164,112.426,-31.669,70.,-66.31,50.,-90.805,92.426],
[-31.669,70.,-7.174,27.574,-41.815,7.574,-66.31,50.],
[-7.174,27.574,17.321,-14.853,-17.321,-34.853,-41.815,7.574]];
var posn=
[[121.244,-74.853,96.749,-32.426,131.39,-12.426,155.885,-54.853],
[96.749,-32.426,72.254,10.,106.895,30.,131.39,-12.426],
[72.254,10.,47.759,52.426,82.4,72.426,106.895,30.],
[155.885,-54.853,131.39,-12.426,154.484,.907,178.979,-41.519],
[131.39,-12.426,106.895,30.,129.989,43.333,154.484,.907],
[106.895,30.,82.4,72.426,105.494,85.76,129.989,43.333],
[178.979,-41.519,154.484,.907,177.578,14.24,202.073,-28.186],
[154.484,.907,129.989,43.333,153.083,56.667,177.578,14.24],
[129.989,43.333,105.494,85.76,128.588,99.093,153.083,56.667],
[202.073,-28.186,177.578,14.24,200.672,27.574,225.167,-14.853],
[177.578,14.24,153.083,56.667,176.177,70.,200.672,27.574],
[153.083,56.667,128.588,99.093,151.682,112.426,176.177,70.],
[-225.167,-14.853,-200.672,27.574,-166.031,7.574,-190.526,-34.853],
[-200.672,27.574,-176.177,70.,-141.536,50.,-166.031,7.574],
[-176.177,70.,-151.682,112.426,-117.041,92.426,-141.536,50.]];
var posb=	      
[[-30.438,-22.426,-79.428,-22.426,-79.428,17.574,-30.438,17.574],
[-79.428,-22.426,-128.418,-22.426,-128.418,17.574,-79.428,17.574],
[-128.418,-22.426,-177.408,-22.426,-177.408,17.574,-128.418,17.574],
[-30.438,17.574,-79.428,17.574,-79.428,44.24,-30.438,44.24],
[-79.428,17.574,-128.418,17.574,-128.418,44.24,-79.428,44.24],
[-128.418,17.574,-177.408,17.574,-177.408,44.24,-128.418,44.24],
[-30.438,44.24,-79.428,44.24,-79.428,70.907,-30.438,70.907],
[-79.428,44.24,-128.418,44.24,-128.418,70.907,-79.428,70.907],
[-128.418,44.24,-177.408,44.24,-177.408,70.907,-128.418,70.907],
[-30.438,70.907,-79.428,70.907,-79.428,97.574,-30.438,97.574],
[-79.428,70.907,-128.418,70.907,-128.418,97.574,-79.428,97.574],
[-128.418,70.907,-177.408,70.907,-177.408,97.574,-128.418,97.574],
[30.438,97.574,79.428,97.574,79.428,57.574,30.438,57.574],
[79.428,97.574,128.418,97.574,128.418,57.574,79.428,57.574],
[128.418,97.574,177.408,97.574,177.408,57.574,128.418,57.574]];
var posw=
[[-121.244,74.853,-96.749,32.426,-131.39,12.426,-155.885,54.853],
[-96.749,32.426,-72.254,-10.,-106.895,-30.,-131.39,12.426],
[-72.254,-10.,-47.759,-52.426,-82.4,-72.426,-106.895,-30.],
[-155.885,54.853,-131.39,12.426,-154.484,-.907,-178.979,41.519],
[-131.39,12.426,-106.895,-30.,-129.989,-43.333,-154.484,-.907],
[-106.895,-30.,-82.4,-72.426,-105.494,-85.76,-129.989,-43.333],
[-178.979,41.519,-154.484,-.907,-177.578,-14.24,-202.073,28.186],
[-154.484,-.907,-129.989,-43.333,-153.083,-56.667,-177.578,-14.24],
[-129.989,-43.333,-105.494,-85.76,-128.588,-99.093,-153.083,-56.667],
[-202.073,28.186,-177.578,-14.24,-200.672,-27.574,-225.167,14.853],
[-177.578,-14.24,-153.083,-56.667,-176.177,-70.,-200.672,-27.574],
[-153.083,-56.667,-128.588,-99.093,-151.682,-112.426,-176.177,-70.],
[225.167,14.853,200.672,-27.574,166.031,-7.574,190.526,34.853],
[200.672,-27.574,176.177,-70.,141.536,-50.,166.031,-7.574],
[176.177,-70.,151.682,-112.426,117.041,-92.426,141.536,-50.]];
var poss=	      
[[-160.087,-52.426,-135.592,-10.,-100.951,-30.,-125.446,-72.426],
[-135.592,-10.,-111.097,32.426,-76.456,12.426,-100.951,-30.],
[-111.097,32.426,-86.603,74.853,-51.962,54.853,-76.456,12.426],
[-125.446,-72.426,-100.951,-30.,-77.857,-43.333,-102.352,-85.76],
[-100.951,-30.,-76.456,12.426,-53.362,-.907,-77.857,-43.333],
[-76.456,12.426,-51.962,54.853,-28.868,41.519,-53.362,-.907],
[-102.352,-85.76,-77.857,-43.333,-54.763,-56.667,-79.258,-99.093],
[-77.857,-43.333,-53.362,-.907,-30.268,-14.24,-54.763,-56.667],
[-53.362,-.907,-28.868,41.519,-5.774,28.186,-30.268,-14.24],
[-79.258,-99.093,-54.763,-56.667,-31.669,-70.,-56.164,-112.426],
[-54.763,-56.667,-30.268,-14.24,-7.174,-27.574,-31.669,-70.],
[-30.268,-14.24,-5.774,28.186,17.321,14.853,-7.174,-27.574],
[56.164,-112.426,31.669,-70.,66.31,-50.,90.805,-92.426],
[31.669,-70.,7.174,-27.574,41.815,-7.574,66.31,-50.],
[7.174,-27.574,-17.321,14.853,17.321,34.853,41.815,-7.574]];
var unit2=   //動かない面 t,n,e,s,w,bの順
[[10,11,13,14,16,17,19,20,22,23,25,26,28,29,31,32,34,35,37,38,40,41,43,44,
45,46,47,48,49,50,51,52,53],
[1,2,4,5,7,8,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,
48,49,50,51,52,53],
[3,4,5,6,7,8,9,10,11,12,13,14,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,
46,47,49,50,52,53],
[0,1,3,4,6,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,39,40,41,42,43,44,
45,46,47,48,49,50],
[0,1,2,3,4,5,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,
45,46,48,49,51,52],
[0,1,2,3,4,5,6,7,8,9,10,12,13,15,16,18,19,21,22,24,25,27,28,30,31,33,34,
36,37,39,40,42,43]];
var unit3=[   //half turn color
[15,12,9,0,3,6,1,4,7,2,5,8,27,30,33], //t+ 0
[24,21,18,2,1,0,5,4,3,8,7,6,36,39,42], //t- 11
[18,19,20,15,16,17,12,13,14,9,10,11,42,43,44], //n+ 1
[6,19,11,9,12,15,10,13,16,11,14,17,47,46,45], //n -
[0,1,2,18,21,24,19,22,25,20,23,26,45,48,51],  //e+ 2
[17,1,26,20,19,18,23,22,21,26,25,24,29,28,27],
[53,52,51,35,32,29,34,31,28,33,30,27,8,5,2],//s+
[36,52,27,33,34,35,30,31,32,27,28,29,24,25,26],
[35,34,33,38,37,36,41,40,39,44,43,42,11,10,9],//w+
[47,34,42,44,41,38,43,40,37,42,39,36,6,7,8],
[38,41,44,53,50,47,52,49,46,51,48,45,26,23,20],
[29,41,45,51,52,53,48,49,50,45,46,47,17,14,11]];
var unit4=[   //halfturn boarder lines
[[0.,-20.],[103.923,-80.],[207.846,-20.], //t
[-30.438,-57.574],[-30.438,22.426],[-177.408,22.426],[-177.408,-57.574]],
[[173.205,-80],[173.205,40],[69.282,100], //n
[-190.526,-34.853],[-121.244,-74.853],[-47.759,52.426],[-117.041,92.426]],
[[138.564,100],[34.641,40],[34.641,-80], //e
[-90.805,92.426],[-160.087,52.426],[-86.603,-74.853],[-17.321,-34.853]],
[[-138.564,-100],[-34.641,-40],[-34.641,80],  //s
[90.805,-92.426],[160.087,-52.426],[86.603,74.853],[17.321,34.853]],
[[-173.205,80],[-173.205,-40],[-69.282,-100], //w
[190.526,34.853],[121.244,74.853],[47.759,-52.426],[117.041,-92.426]],
[[-0.,20.],[-103.923,80.],[-207.846,20.],  //b
[30.438,57.574],[30.438,-22.426],[177.408,-22.426],[177.408,57.574]]];
var cols=["#ffffff","#0000ff","#ff0000","#00ff00","#ffa600","#ffff00"]; //color 
Math.radians=function(degrees)
  {return degrees*Math.PI/180;};
var u=40; var a=u*Math.cos(Math.radians(30)), b=u/2;
var r2=Math.sqrt(2), c=a/r2, d=b*3/r2;
var c0=3*a-3*c, c1=c0+c*2, c2=c1+c*2, c3=c2+c*2;
var d0=d-b, d1=d0-u, d2=d1-2*u/3, d3=d2-2*u/3, d4=d3-2*u/3;
var d5=d4+u; var root3=Math.sqrt(3);
var nb=[,21,,12,,30,,39,,,43,,3,,46,,19,,,16,,1,,48,,28,
        ,,25,,1,,52,,37,,,34,,7,,50,,10,,,14,,23,,41,,32,];
function drawcc(i){
if(((ccs[i]==0)||(ccs[i]==5))&&(i%9!=4)){chief(pos[i]);}
var n=nb[i];
if(((ccs[i]==2)||(ccs[i]==4))&&((i%9)%2==1)&&((ccs[n]==1)||(ccs[n]==3))){chief(pos[i]);}}
function draw1(){//alert("draw1"); //全画面を描く
context.save();
context.translate(227.8,140);
 for(var i=0;i<54;i++){
 drawparagram(cols[ccs[i]],pos[i]);
 drawcc(i);}
 context.restore();}

function printtext(a,x,y){
context.font = "15px serif";
context.fillStyle = "#000000";
var metrics = context.measureText(a);
context.fillText(a,x-metrics.width/2,y);}

function center(s,x,y,f,c){
context.font = f; //"15px serif"
context.fillStyle = c; //"#000000"
var metrics = context.measureText(s);
context.fillText(s,x-metrics.width/2,y);}
function center2(x,y,n){
context.font = "15px serif";
context.fillStyle = "#000000";
var metrics = context.measureText(n);
context.fillText(n,x-metrics.width/2,y);}

function gettime(y){
  var dt=new Date();
  return [dt.getHours(),dt.getMinutes(),dt.getSeconds()];}

var hms0=gettime();
function clearbase(){
context.clearRect(0,0,500,300);
context.save();

var hms=gettime();
center(str(hms[0])+" "+str(hms[1])+" "+str(hms[2]),450,15,"16px serif","#000000");
if(hms!=0){center(str(hms0[0])+" "+str(hms0[1])+" "+str(hms0[2]),450,30,"16px serif","#000000");}
/*		printtext("B+",190,276);
		printtext("T+",210,276);
		printtext("S+",230,276);
		printtext("W+",250,276);
center("T+",190,278,"16px serif","#000000");
center("N+",215,278,"16px serif","#000000");
center("E+",240,278,"16px serif","#000000");
center("S+",265,278,"16px serif","#000000");
center(362,300,278,"16px serif","#000000");
center("/",318,278,"16px serif","#000000");
center(366,336,278,"16px serif","#000000");*/
printtext((rotseq.length).toString(10),470,45);
context.strokeStyle="#000000";
context.strokeRect(450,120,40,20);
context.strokeRect(450,150,40,20);
context.strokeRect(450,180,40,20);
context.strokeRect(450,210,40,20);
context.strokeRect(450,240,40,20);
context.strokeRect(450,270,40,20);
center("Clr",470,198,"16px serif","#000000");
center("Man",470,228,"16px serif","#000000");
center("Ran",470,258,"16px serif","#000000");
center("Res",470,288,"16px serif","#000000");
context.save();
context.translate(227.8,140);
context.strokeRect(103.923,-120,40,-20); //t
context.strokeRect(103.923,-120,-40,-20);
context.strokeRect(173.205,100,40,20); //n
context.strokeRect(173.205,100,-40,20);
context.strokeRect(34.641,100,40,20); //e
context.strokeRect(34.641,100,-40,20);
context.strokeRect(-34.641,-100,40,-20); //s
context.strokeRect(-34.641,-100,-40,-20);
context.strokeRect(-173.205,-100,40,-20); //w
context.strokeRect(-173.205,-100,-40,-20);
context.strokeRect(-103.923,120,40,20); //b
context.strokeRect(-103.923,120,-40,20);
center("t+",123.923,-124,"16px serif","#000000");
center("t-",83.923,-124,"16px serif","#000000");			    
center("n+",193.205,116,"16px serif","#000000");
center("n-",153.205,116,"16px serif","#000000");			    
center("e+",54.641,116,"16px serif","#000000");
center("e-",14.541,116,"16px serif","#000000");			    
center("s+",-14.641,-104,"16px serif","#000000");
center("s-",-54.541,-104,"16px serif","#000000");			    
center("w+",-153.205,-104,"16px serif","#000000");
center("w-",-193.205,-104,"16px serif","#000000");			    
center("b+",-83.923,136,"16px serif","#000000");
center("b-",-123.923,136,"16px serif","#000000");			    
context.strokeRect(-200,145,400,10);
context.fillRect(-200,145,200*(time+1)/rotseq.length,10);//percentage of path
context.restore();}
			    
function draw() {//alert("draw"+":"+time);
		clearbase();
   if(time%2==0){draw3(rotseq[time/2]);}
   else{rotatecube(rotseq[(time-1)/2]);draw1();}
   time=time+1;
 if(time==rotseq.length*2){
 clearInterval(intervalID);}
}
function draw3(n){//alert("draw3 :"+n);
var q=[post,posn,pose,poss,posw,posb,posb,posw,poss,pose,posn,post][n];
var p=unit3[[0,2,4,6,8,10,11,9,7,5,3,1][n]];
context.save();
context.translate(227.8,140);
for(var i=12;i<15;i++){
drawparagram(cols[ccs[p[i]]],q[i]);}
p=unit4[[0,1,2,3,4,5,5,4,3,2,1,0][n]];
context.moveTo(p[0][0],p[0][1]);
context.lineTo(p[1][0],p[1][1]);
context.lineTo(p[2][0],p[2][1]);
context.moveTo(p[3][0],p[3][1]);
context.lineTo(p[4][0],p[4][1]);
context.lineTo(p[5][0],p[5][1]);
context.lineTo(p[6][0],p[6][1]);
context.stroke();//alert("draw3.1"+rotseq);
p=unit2[[0,1,2,3,4,5,5,4,3,2,1,0][n]];//alert("draw3-1  "+rotseq);
for(var i=0;i<33;i++){
k=p[i];
   drawparagram(cols[ccs[k]],pos[k]);
   drawcc(k);}
p=unit3[[0,2,4,6,8,10,11,9,7,5,3,1][n]];
for(var i=0;i<12;i++){
   drawparagram(cols[ccs[p[i]]],q[i]);}//alert("draw3-2  "+rotseq);
   context.restore();}

function clear() {//alert("clear");
	       rotseq=[];
	       for(var i=0;i<54;i++){ccs[i]=Math.floor(i/9);}
}

function rand(){//alert("random");
rotseq=[];	   
var t=10+Math.floor(Math.random()*20);//alert(t);
for(var j=0;j<t;j++){var s=Math.floor(12*Math.random());
center("RAN",20,15,"16px serif","#000000");
   rotseq.push(s);}

time=0;intervalID=setInterval(draw,100);}

function rest(){//alert("restore");
draw1();time=0;
intervalID;//=setInterval(draw,100);
}

// cubesolver //
var cs=[],es=[],fs=[],gs=[];
function initcube(){
for(var i=0;i<54;i++){ccs[i]=Math.floor(i/9);}}
var ccc=[[0,4,1],[0,1,2],[0,2,3],[0,3,4],[5,1,4],[5,2,1],[5,3,2],[5,4,3],
  [1,0,4],[2,0,1],[3,0,2],[4,0,3],[4,5,1],[1,5,2],[2,5,3],[3,5,4],
  [4,1,0],[1,2,0],[2,3,0],[3,4,0],[1,4,5],[2,1,5],[3,2,5],[4,3,5]];
var cca=[[6,42,9],[0,15,18],[2,24,27],[8,33,36],
  [47,11,44],[45,20,17],[51,29,26],[53,38,35]];
var ecc=[[0,1],[0,2],[0,3],[0,4],[4,1],[2,1],[2,3],[4,3],[5,1],[5,2],[5,3],[5,4],
  [1,0],[2,0],[3,0],[4,0],[1,4],[1,2],[3,2],[3,4],[1,5],[2,5],[3,5],[4,5]];
var eca=[[3,12],[1,21],[5,30],[7,39],[43,10],[19,16],
  [25,28],[37,34],[46,14],[48,23],[52,32],[50,41]];

function shuffle(ls,ss,ds){
  var cc=ss.map(function(x){return ls[x];});
  for(var i=0;i<cc.length;i++){
    ls[ds[i]]=cc[i];}}
	       
var cpermtab=[
[[1,0],[[2,1,0]]],[[2,0],[[0,1,2]]],[[3,0],[[3,0,1]]],[[4,0],[[4,0,1]]],
[[5,0],[[0,1,5]]],[[6,0],[[1,2,6],[1,0,4]]],[[7,0],[[0,3,7]]],
[[2,1],[[3,2,1]]],[[3,1],[[1,2,3]]],[[4,1],[[1,5,4]]],[[5,1],[[5,1,2]]],
[[6,1],[[1,2,6]]],[[7,1],[[2,3,7],[3,2,1]]],[[3,2],[[3,2,6]]],
[[4,2],[[4,5,6],[2,6,5]]],[[5,2],[[2,6,5]]],[[6,2],[[6,2,3]]],
[[7,2],[[2,3,7]]],[[4,3],[[3,7,4]]],[[5,3],[[5,6,7],[3,7,6]]],
[[6,3],[[3,7,6]]],[[7,3],[[4,7,3]]],[[5,4],[[6,5,4]]],[[6,4],[[4,5,6]]],
[[7,4],[[7,4,5]]],[[6,5],[[7,6,5]]],[[7,5],[[5,6,7]]]];
var js=[
[[1,2,3],[2,2,3,3,9,10,2,3,3,9,1,9]],[[0,3,7],[0,0,3,3,11,10,0,3,3,11,1,11]],
[[3,7,4],[3,3,5,5,8,11,3,5,5,8,0,8]],
[[7,3,2],[4,4,0,0,7,6,4,0,0,7,5,7]],[[6,7,3],[5,5,4,4,6,9,5,4,4,6,2,6]],
[[2,6,7],[2,2,5,5,9,11,2,5,5,9,0,9]],[[3,2,6],[0,0,2,2,11,7,0,2,2,11,4,11]],
[[7,6,5],[3,3,2,2,8,7,3,2,2,8,4,8]],[[6,5,4],[2,2,1,1,9,8,2,1,1,9,3,9]],
[[5,4,7],[1,1,4,4,10,9,1,4,4,10,2,10]],
[[5,6,2],[5,5,3,3,6,10,5,3,3,6,1,6]],
[[2,1,5],[0,0,1,1,11,8,0,1,1,11,3,11]],[[6,2,1],[3,3,0,0,8,6,3,0,0,8,5,8]],
[[5,1,0],[2,2,0,0,9,6,2,0,0,9,5,9]],[[1,0,4],[0,0,4,4,11,9,0,4,4,11,2,11]],
[[4,5,1],[5,5,2,2,6,7,5,2,2,6,4,6]],[[0,1,2],[1,1,2,2,10,7,1,2,2,10,4,10]],
[[3,0,1],[4,4,1,1,7,8,4,1,1,7,3,7]]];
var epermtab=[
[[1,0],[[2,1,0]]],[[2,0],[[0,3,2]]],[[3,0],[[3,0,1]]],[[4,0],[[4,0,5]]],
[[5,0],[[5,0,4]]],[[6,0],[[6,1,5],[2,1,0]]],[[7,0],[[7,2,6],[0,1,2]]],
[[8,0],[[0,4,8]]],[[9,0],[[1,5,9],[1,0,3]]],[[10,0],[[2,7,10],[0,1,2]]],
[[11,0],[[3,4,11],[3,0,1]]],[[2,1],[[3,2,1]]],[[3,1],[[1,2,3]]],
[[4,1],[[5,8,4],[5,1,6]]],[[5,1],[[5,1,6]]],[[6,1],[[6,1,5]]],
[[7,1],[[7,2,6],[3,2,1]]],[[8,1],[[4,8,5],[5,1,6]]],[[9,1],[[9,5,1]]],
[[10,1],[[7,10,6],[6,1,5]]],[[11,1],[[9,10,11],[1,5,9]]],
[[3,2],[[3,7,11],[7,2,6]]],[[4,2],[[7,3,4],[7,2,6]]],
[[5,2],[[6,9,5],[6,2,7]]],[[6,2],[[6,2,7]]],[[7,2],[[7,2,6]]],
[[8,2],[[10,11,8],[2,6,10]]],[[9,2],[[8,9,10],[2,6,10]]],
[[10,2],[[2,6,10]]],[[11,2],[[11,10,9],[2,6,10]]],[[4,3],[[4,3,7]]],
[[5,3],[[4,8,5],[4,3,7]]],[[6,3],[[7,10,6],[7,3,4]]],[[7,3],[[7,3,4]]],
[[8,3],[[5,8,4],[4,3,7]]],[[9,3],[[11,10,9],[3,7,11]]],
[[10,3],[[10,11,8],[3,7,11]]],[[11,3],[[3,7,11]]],[[5,4],[[4,8,5]]],
[[6,4],[[5,9,6],[4,8,5]]],[[7,4],[[4,11,7]]],[[8,4],[[5,8,4]]],
[[9,4],[[6,9,5],[4,8,5]]],[[10,4],[[8,9,10],[5,8,4]]],[[11,4],[[7,11,4]]],
[[6,5],[[5,9,6]]],[[7,5],[[6,10,7],[5,9,6]]],[[8,5],[[8,9,10],[6,9,5]]],
[[9,5],[[6,9,5]]],[[10,5],[[10,9,8],[6,9,5]]],[[11,5],[[9,10,11],[6,9,5]]],
[[7,6],[[6,10,7]]],[[8,6],[[10,9,8],[7,10,6]]],[[9,6],[[8,9,10],[7,10,6]]],
[[10,6],[[7,10,6]]],[[11,6],[[11,10,9],[7,10,6]]],
[[8,7],[[7,11,4],[8,11,10],[4,11,7]]],[[9,7],[[7,10,6],[9,10,11],[6,10,7]]],
[[10,7],[[7,11,4],[10,11,8],[4,11,7]]],[[11,7],[[7,10,6],[11,10,9],[6,10,7]]],
[[9,8],[[10,9,8]]],[[10,8],[[8,9,10]]],[[11,8],[[11,8,9]]],
[[10,9],[[11,10,9]]],[[11,9],[[9,10,11]]]];
var hs=[
[[1,2,3],[3,3,0,9,4,3,3,2,7,0,3,3]],[[3,7,11],[3,3,4,11,5,3,3,0,6,4,3,3]],
[[7,11,4],[5,5,4,8,1,5,5,3,10,4,5,5]],[[11,4,3],[1,1,4,6,0,1,1,5,11,4,1,1]],
[[4,3,7],[0,0,4,10,3,0,0,1,8,4,0,0]],[[7,2,6],[0,0,3,7,2,0,0,4,9,3,0,0]],
[[10,7,2],[4,4,3,6,0,4,4,5,11,3,4,4]],[[6,10,7],[5,5,3,9,4,5,5,2,7,3,5,5]],
[[2,6,10],[2,2,3,11,5,2,2,0,6,3,2,2]],[[10,9,8],[2,2,5,8,1,2,2,3,10,5,2,2]],
[[9,8,11],[1,1,5,9,4,1,1,2,7,5,1,1]],[[8,11,10],[4,4,5,10,3,4,4,1,8,5,4,4]],
[[11,10,9],[3,3,5,7,2,3,3,4,9,5,3,3]],
[[5,9,6],[5,5,2,10,3,5,5,1,8,2,5,5]],[[1,5,9],[1,1,2,11,5,1,1,0,6,2,1,1]],
[[6,1,5],[0,0,2,8,1,0,0,3,10,2,0,0]],[[5,0,4],[0,0,1,9,4,0,0,2,7,1,0,0]],
[[0,4,8],[4,4,1,11,5,4,4,0,6,1,4,4]],[[4,8,5],[5,5,1,7,2,5,5,4,9,1,5,5]],
[[0,1,2],[2,2,0,10,3,2,2,1,8,0,2,2]],[[3,0,1],[1,1,0,7,2,1,1,4,9,0,1,1]],
[[2,3,0],[4,4,0,8,1,4,4,3,10,0,4,4]]];
var ks=[
//[[1,0],[2,1,1,2,11,3,3,0,9,1,1,2,11,3,3,0,9,9]],
[[0,1],[2,2,11,8,8,0,9,10,10,2,11,8,8,0,9,10,10,9]],
[[1,2],[1,0,0,1,9,5,5,2,10,0,0,1,9,5,5,2,10,10]],
//[[3,2],[4,3,3,4,11,1,1,0,7,3,3,4,11,1,1,0,7,7]],
[[2,3],[4,4,11,10,10,0,7,8,8,4,11,10,10,0,7,8,8,7]],
[[3,7],[0,4,4,0,8,2,2,3,11,4,4,0,8,2,2,3,11,11]],
//[[6,7],[2,3,3,2,6,1,1,5,9,3,3,2,6,1,1,5,9,9]],
[[7,6],[2,2,6,10,10,5,9,8,8,2,6,10,10,5,9,8,8,9]],
[[6,5],[3,5,5,3,9,0,0,2,8,5,5,3,9,0,0,2,8,8]],
//[[4,5],[4,1,1,4,6,3,3,5,7,1,1,4,6,3,3,5,7,7]],
[[5,4],[4,4,6,8,8,5,7,10,10,4,6,8,8,5,7,10,10,7]]];
var is=[
[[0,1],[10,0,0,1,1,0,10,11,10,0,0,3,2,1,9,8]],
[[1,5],[11,2,2,0,0,2,11,9,11,2,2,5,1,0,10,6]],
[[8,5],[6,1,1,5,5,1,6,10,6,1,1,0,2,5,9,11]],
//[[5,8],[0,2,6,9,11,10,10,5,1,5,10,6,6,10,10,5]],
[[9,8],[9,5,5,2,2,5,9,6,9,5,5,4,1,2,10,7]],
//[[8,9],[4,1,9,10,7,6,6,2,5,2,6,9,9,6,6,2]],
[[9,6],[6,2,2,5,5,2,6,9,6,2,2,0,3,5,8,11]],
[[2,6],[11,3,3,0,0,3,11,8,11,3,3,5,2,0,9,6]],
//[[6,2],[5,2,11,9,6,8,8,0,3,0,8,11,11,8,8,0]],
[[2,3],[8,0,0,3,3,0,8,11,8,0,0,1,4,3,7,10]],
[[3,7],[11,4,4,0,0,4,11,7,11,4,4,5,3,0,8,6]],
[[10,7],[6,3,3,5,5,3,6,8,6,3,3,0,4,5,7,11]],
//[[7,10],[0,4,6,7,11,8,8,5,3,5,8,6,6,8,8,5]],
[[11,10],[7,5,5,4,4,5,7,6,7,5,5,2,3,4,8,9]],
//[[10,11],[2,3,7,8,9,6,6,4,5,4,6,7,7,6,6,4]],
[[11,4],[6,4,4,5,5,4,6,7,6,4,4,0,1,5,10,11]]];

function eqarray (as,bs){
  var truth=true,m=as.length,n=bs.length;
  if(m!=n){truth=false;}
  else{for(var i=0;i<m;i++){
    if(as[i]!=bs[i]){truth=false;}}}
  return truth;}
function elemindex(a,as){
  var j=-1,l=as.length;
  for(var i=0;i<l;i++){if(eqarray(a,as[i])){j=i;}}
  return (j);}
function colsel(ca){
  return ca.map(function(x){return ccs[x];});}
function assoc(a,as){
  var ans=-1,l=as.length;
  for(var i=0;i<l;i++){if(eqarray(a,as[i][0])){ans=i;break;}}
  if(ans<0){return false;}else{return as[ans];}}

function getcs(){var cc=cca.map(function(x){return colsel(x);});
  return cc.map(function(x){return elemindex(x,ccc)%8;});}
function getes(){var cc=eca.map(function(x){return colsel(x);});
  return cc.map(function(x){return elemindex(x,ecc)%12;});}
function gettwist(){var cc=cca.map(function(x){return colsel(x);});
  return cc.map(function(x){return Math.floor(elemindex(x,ccc)/8);});}
function getflip(){var cc=eca.map(function(x){return colsel(x);});
  return cc.map(function(x){return Math.floor(elemindex(x,ecc)/12);});}

function search(triplet,table){//alert("search "+triplet);
  var g0=listcopy(triplet);var tri=g0.reverse(); 
  var e=assoc(triplet,table),g=assoc(tri,table);
  if(e!=false){return e[1];}
  if(g!=false){var gg=(listcopy(g[1])).reverse();return(gg.map(function(x){return 11-x;}));}}

function crot(tri) {//alert("crot "+tri);
  var t=cs[tri[2]];cs[tri[2]]=cs[tri[1]];cs[tri[1]]=cs[tri[0]];cs[tri[0]]=t;
  var aa=search(tri,js);
  aa.map(function(x){rotatecube(x);});}

function erot(tri) {//alert("erot "+tri);
  var t=es[tri[2]];es[tri[2]]=es[tri[1]];es[tri[1]]=es[tri[0]];es[tri[0]]=t;
  var aa=search(tri,hs);
  aa.map(function(x){rotatecube(x);});}
				  
function parity(as){
var p=0,l=as.length;
for(var i=1;i<l;i++){
  var a=as[i];
  for(var j=0;j<i;j++){
  if(as[j]>a){p=1-p;}}} return p;}

function crestore(){//alert("cres");
var i=-1;
for (var j=0;j<8;j++) {if(cs[j]!=j){i=j;break;}}
if(0 <= i){var j=cs.indexOf(i);
  var k=assoc([j,i],cpermtab);
  k[1].map(function(x){crot(x);})
  crestore();}}

function erestore(){//alert("eres");
var i=-1;
for (var j=0;j<12;j++){if(es[j]!=j){i=j;break;}}
  if(0 <= i){var j=es.indexOf(i);
  var k=assoc([j,i],epermtab);
  k[1].map(function(x){erot(x);})
  erestore();}}

function ss(a){if(a<0){return a;}else{return ccs[a];};}	
function sel(x){return [ss(x[0]),ss(x[1]),ss(x[2])];}
function cordir(x){//alert("cordir "+x+":"+sel(x[1]));
var cc=x[1].map(function(y){if(y<0){return -3;}else{return ccs[y];}});
return cc.indexOf(x[0]);}

function frestore(){//alert("frestore");
function incl(n){return (n+1)%3;}
function decl(n){return (n+2)%3;}					   
shuffle(fs,[4,5,6,7],[7,6,5,4]);
for(var i=0;i<7;i++){
  var m0=fs[i],m1=fs[i+1],k=ks[i];
  if(m0==1) {
   fs[i]=decl(m0);
   fs[i+1]=incl(m1);
   var kk=(listcopy(k[1])).reverse();
   kk=kk.map(function (x){return 11-x;});
   kk.map(function (x){rotatecube(x);});}
  if(m0==2) {
   fs[i]=incl(m0);
   fs[i+1]=decl(m1);
  k[1].map(function (x){rotatecube(x);});}
  }}

function grestore(){//alert("grestore");
 shuffle(gs,[2,3,4,5,6,7,8,9,10,11],[6,7,11,2,5,8,3,4,9,10]);
 for(var i=0;i<11;i++){
   var m0=gs[i],m1=gs[i+1],k=is[i];
   if(m0==1){
   gs[i]=0;
   gs[i+1]=1-m1;
   k[1].map(function(x){rotatecube(x);});}}}

function testps(){//alert("testps");
for(var i=0;i<rotseq.length;i++){
if(((i+3)<=rotseq.length)&&(rotseq[i]==rotseq[i+1])&&(rotseq[i+1]==rotseq[i+2])){
rotseq[i+2]=11-rotseq[i+2];rotseq.splice(i,2);i=Math.max(-1,i-3);}
if(((i+2)<=rotseq.length)&&(rotseq[i]+rotseq[i+1]==11)){
rotseq.splice(i,2);i=Math.max(-1,i-4);}}}

//function getfs(){return fss.map(function(x){return cordir(x);});}	   
//function getgs(){return gss.map(function(x){return cordir(x);});}	   

function inspect(s){alert(s+":"+compress(ccs));
alert(getcs()+":"+getes()+":"+gettwist()+":"+getflip()+":"+rotseq.length);}

function restore(){//alert("restore");
restmode=true;//alert(ccs);
var initccs=listcopy(ccs);	   
rotseq=[];
cs=getcs();//alert("parity "+parity(cs));
if(parity(cs)==1){
rotatecube([5,11,1,0,10,7,6,4][cs.indexOf(0)]);}
cs=getcs();es=getes();
crestore();var crotseq=rotseq.length; //inspect("cres ");
erestore();var erotseq=rotseq.length; //inspect("eres ");
fs=gettwist();
frestore();var frotseq=rotseq.length; //inspect("fres ");
gs=getflip();
grestore();var grotseq=rotseq.length; //inspect("gres ");
testps();/*alert("tres ");*/restmode=false;
var trotseq=rotseq.length; //inspect("tres ");//alert(ccs);
//alert(crotseq+" "+erotseq+" "+frotseq+" "+grotseq+" "+trotseq);
ccs=listcopy(initccs);//alert("end restore");
	   }
// end solver //	   
function det(x0,y0,x1,y1,x2,y2) {return (x0*y1+x1*y2+x2*y0-x0*y2-x1*y0-x2*y1);}
function inside(x,y,pos){//alert(x+","+y+","+pos);
  var x0=pos[0],y0=pos[1],x1=pos[2],y1=pos[3],x2=pos[4],y2=pos[5],x3=pos[6],y3=pos[7];
  return ((det(x,y,x0,y0,x1,y1)<0)&&(det(x,y,x1,y1,x2,y2)<0)&&
          (det(x,y,x2,y2,x3,y3)<0)&&(det(x,y,x3,y3,x0,y0)<0));}

function doKeyDown(evt) {
  var ch=evt.keyCode-48;
  return (ch);}

function getPosition(event){
       var x = new Number();
       var y = new Number();
       var canvas = document.getElementById("mycanvas");
       if (event.x != undefined && event.y != undefined)  {
         x = event.x;
         y = event.y;     }
        else{ // Firefox method to get the position
         x = event.clientX + document.body.scrollLeft +
             document.documentElement.scrollLeft;
         y = event.clientY + document.body.scrollTop +
             document.documentElement.scrollTop;  }
        x -= canvas.offsetLeft;
        y -= canvas.offsetTop;
	   x0=x;y0=y;//  alert(x+"  "+y);
var bospos=[[450,180],[450,210],[450,240],[450,270],
	   [103.423+227.8,-140+140],[63.423+227.8,-140+140],
	   [173.205+227.8,100+140],[133.205+227.8,100+140],
	   [34.641+227.8,100+140],[-5.359+227.8,100+140],
	   [-34.641+227.8,-120+140],[-74.641+227.8,-120+140],
	   [-173.205+227.8,-120+140],[-213.205+227.8,-120+140],
	   [-103.923+227.8,120+140],[-143.923+227.8,120+140],[450,150],
           [450,120]];
if(x<20&&y<20){
	    ccs=[0,5,0,5,0,5,0,5,0,1,3,1,3,1,3,1,3,1,2,4,2,4,2,4,2,4,2,
	    3,1,3,1,3,1,3,1,3,4,2,4,2,4,2,4,2,4,5,0,5,0,5,0,5,0,5];
check();draw1();}
key=-1;
for(var i=0;i<18;i++) {
 if((bospos[i][0]<=x)&&(x<bospos[i][0]+40)&&
   (bospos[i][1]<=y)&&(y<bospos[i][1]+20))
   {key=i;}}
   if(key==0){clear();clearbase(0);draw1();}
   if(key==1){time=0;rotseq=[];}
   if(key==3){hms0=gettime();restore();
    time=0;intervalID=setInterval(draw,100);}
   if(key==2){rand();clearbase();draw1();}
   if(key==16) {rotseq=rotseq.reverse();rotseq=rotseq.map(function(x){return 11-x;});
    time=0;intervalID=setInterval(draw,100);}
   if(key==17) {instruct();}							    
   if(key>=4&&key<16){
   rotseq.push([0,11,1,10,2,9,3,8,4,7,5,6][key-4]);
   time=time+0;intervalID=setInterval(draw,100);}

for(var j=0;j<54;j++){if (inside (x-227.8,y-140,pos[j])){
if((j%9)!=4){ccs[j]=(ccs[j]+1)%6;}check();draw1();}
  }}
			 function getSum(total,num){return total+num;}
			 function histccs(){
			 var hs=[0,0,0,0,0,0];
			 for(var i=0;i<54;i++){
					var a=ccs[i];hs[a]=hs[a]+1;}
  					return(eqarray(hs,[9,9,9,9,9,9]));}
			 function check(){
			 cs=getcs();es=getes();fs=gettwist();gs=getflip();
			 if((parity(cs)==parity(es))&& histccs() &&
			 (fs.reduce(getSum)%3==0)&&(gs.reduce(getSum)%2==0))
			 {context.clearRect(464,125,12,17);
			 center("O",470,140,"16px serif","#00ff00");}
			 else
			 {context.clearRect(464,125,12,17);
			 center("X",470,140,"16px serif","#ff0000");}}

function initialize()
      { var canvas = document.getElementById("mycanvas");
        canvas.addEventListener("mousedown", getPosition, false);
        window.addEventListener('keydown',doKeyDown,true);
	  }
initialize();clearbase();draw1();
//intervalID;//=setInterval(draw,100);					     
time=0;clearbase();draw1();

</script>
</body>
</html>

